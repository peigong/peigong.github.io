<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>使用grunt-run-grunt插件组织团队的开发 | VET. 周培公</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="项目构建的需求在组织项目的开发工作时，如果构建工具选型是Grunt，那么常常有以下几个需求：  Gruntfile文件随着项目复杂性的增加，会变的越来越庞大。为了便于开发团队的分工协作，需要在某种程度上分拆Gruntfile，让不同的团队、不同的开发者关注不同的部分。 把Gruntfile分拆成不同的文件后，既要有统一的入口执行整体的构建，又要能够使分拆后的Gruntfile不依赖于其他部分独立构">
<meta property="og:type" content="article">
<meta property="og:title" content="使用grunt-run-grunt插件组织团队的开发">
<meta property="og:url" content="http://pg.js.cn/articles/it-lessons-2013-10-15-project-use-grunt-run-grunt.html">
<meta property="og:site_name" content="VET. 周培公">
<meta property="og:description" content="项目构建的需求在组织项目的开发工作时，如果构建工具选型是Grunt，那么常常有以下几个需求：  Gruntfile文件随着项目复杂性的增加，会变的越来越庞大。为了便于开发团队的分工协作，需要在某种程度上分拆Gruntfile，让不同的团队、不同的开发者关注不同的部分。 把Gruntfile分拆成不同的文件后，既要有统一的入口执行整体的构建，又要能够使分拆后的Gruntfile不依赖于其他部分独立构">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2013-10-14T16:00:00.000Z">
<meta property="article:modified_time" content="2024-08-29T16:00:00.000Z">
<meta property="article:author" content="VET. 周培公">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">VET. 周培公</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">写 JS 代码的周培公是一个兽医</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/proposals">写作计划</a>
        
          <a class="main-nav-link" href="/books">藏书目录</a>
        
      </nav>
      <nav id="sub-nav">
        
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://github.com/peigong"><span class="fa fa-github"></span></a>
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://gitee.com/pg0xff"><span class="fa fa-git"></span></a>
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://user.qzone.qq.com/377650913"><span class="fa fa-qq"></span></a>
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://weibo.com/u/1766654653"><span class="fa fa-weibo"></span></a>
          
            <a class="nav-icon" href="https://pg.js.cn"><span class="fa fa-home"></span></a>
          
        
        
      </nav>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-it-lessons-2013-10-15-project-use-grunt-run-grunt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/articles/it-lessons-2013-10-15-project-use-grunt-run-grunt.html" class="article-date">
  <time class="dt-published" datetime="2013-10-14T16:00:00.000Z" itemprop="datePublished">2013-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">IT</a>►<a class="article-category-link" href="/categories/it/lessons/">培训教程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      使用grunt-run-grunt插件组织团队的开发
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="项目构建的需求"><a href="#项目构建的需求" class="headerlink" title="项目构建的需求"></a>项目构建的需求</h2><p>在组织项目的开发工作时，如果构建工具选型是Grunt，那么常常有以下几个需求：</p>
<ol>
<li>Gruntfile文件随着项目复杂性的增加，会变的越来越庞大。为了便于开发团队的分工协作，需要在某种程度上分拆Gruntfile，让不同的团队、不同的开发者关注不同的部分。</li>
<li>把Gruntfile分拆成不同的文件后，既要有统一的入口执行整体的构建，又要能够使分拆后的Gruntfile不依赖于其他部分独立构建，以确保团队分工的互不干扰。</li>
<li>在整个项目中，package.json和node_modules要能够共用。确保每一部分的开发者，只关注Gruntfile的编写，不需要关注全局共性的package.json和node_modules。</li>
</ol>
<p>不同的团队、 不同的项目因为细化需求的不同，都会各自选择不同的解决方案。</p>
<h2 id="Gruntfile的分拆方案"><a href="#Gruntfile的分拆方案" class="headerlink" title="Gruntfile的分拆方案"></a>Gruntfile的分拆方案</h2><h3 id="Gruntfile文件内的逻辑分组"><a href="#Gruntfile文件内的逻辑分组" class="headerlink" title="Gruntfile文件内的逻辑分组"></a>Gruntfile文件内的逻辑分组</h3><p>使用任务的目标名称，在逻辑上分组构建任务。这是大多数项目最初会用到的方法，如<a target="_blank" rel="noopener" href="https://github.com/basestyle/grunt-cn">grunt中文文档项目(https://github.com/basestyle/grunt-cn)</a>。</p>
<p>在传递给grunt.initConfig方法的对象中，使用如下类似的不同任务目标名称区分webapp和pc两类任务：</p>
<pre><code>jshint:&#123;
    webapp: [&#39;app/www/js/main.js&#39;],
    pc: [&#39;js/chart.js&#39;,&#39;js/common.js&#39;,&#39;js/demand.js&#39;,&#39;js/dialog.js&#39;,&#39;js/formbeautify.js&#39;,&#39;js/jquery.autopagination.js&#39;,
        &#39;js/jquery.cascadeselect.js&#39;,&#39;js/jquery.datepicker.js&#39;,&#39;js/jquery.formvalid.js&#39;,&#39;js/jquery.memberinput.js&#39;,
        &#39;js/jquery.multiupload.js&#39;,&#39;js/jquery.tabs.js&#39;,&#39;js/pmstation.js&#39;,&#39;js/project.js&#39;,&#39;js/setting.js&#39;,&#39;js/tasktable.js&#39;,&#39;js/work.js&#39;]
&#125;,
</code></pre>
<p>在自定义的别名任务中，把两类任务分组成webapp和pc两个单任务：</p>
<pre><code>grunt.registerTask(&#39;webapp&#39;, [&#39;htmlhint:webapp&#39;,&#39;jshint:webapp&#39;,&#39;uglify:webapp&#39;,&#39;cssmin:webapp&#39;,&#39;copy:webapp&#39;,&#39;replace:webapp&#39;]);
grunt.registerTask(&#39;pc&#39;, [&#39;jshint:pc&#39;,&#39;uglify:pc&#39;,&#39;cssmin:pc&#39;,&#39;copy:pc&#39;,&#39;replace:pc&#39;]);
</code></pre>
<p>如果两类任务调用的任务都相同，也可以使用动态别名任务的方法来处理。</p>
<p>代码示例如下：</p>
<pre><code>grunt.registerTask(&#39;build&#39;, &#39;Run all my build tasks.&#39;, function(n) &#123;
  if (n == null) &#123;
    grunt.warn(&#39;Build num must be specified, like build:001.&#39;);
  &#125;
  grunt.task.run(&#39;foo:&#39; + n, &#39;bar:&#39; + n, &#39;baz:&#39; + n);
&#125;);
</code></pre>
<p>参见Grunt文档的《常见问题-“动态”别名任务》(<a target="_blank" rel="noopener" href="http://www.gruntjs.org/article/frequently_asked_questions.html">中文</a>&#x2F;<a target="_blank" rel="noopener" href="http://gruntjs.com/frequently-asked-questions">英文</a>)。</p>
<h3 id="Grunt配置编程处理在不同的文件中"><a href="#Grunt配置编程处理在不同的文件中" class="headerlink" title="Grunt配置编程处理在不同的文件中"></a>Grunt配置编程处理在不同的文件中</h3><p>将配置对象分拆出来，然后在Gruntfile.js中require进来，再将这些不同任务的对象组合成一个对象传递给grunt.initConfig。</p>
<p>上述方案是在我提出问题（<a target="_blank" rel="noopener" href="https://github.com/basestyle/grunt-cn/issues/34">有没有分拆Gruntfile.js的方案？(https://github.com/basestyle/grunt-cn/issues/34)</a>）后，<a target="_blank" rel="noopener" href="http://www.toobug.net/">TooBug</a>[<a target="_blank" rel="noopener" href="https://github.com/TooBug">GitHub</a>]和<a target="_blank" rel="noopener" href="https://github.com/qivhou">Vincent Hou</a>给出的解决方案。</p>
<p>因为没有进一步展开，所以没有示例代码。</p>
<h3 id="使用自定义任务把构建任务分解在不同的文件中"><a href="#使用自定义任务把构建任务分解在不同的文件中" class="headerlink" title="使用自定义任务把构建任务分解在不同的文件中"></a>使用自定义任务把构建任务分解在不同的文件中</h3><p>我在知乎上提出问题《<a target="_blank" rel="noopener" href="http://www.zhihu.com/question/21766711">有什么方案可以把较为庞大的gruntfile分拆？(http://www.zhihu.com/question/21766711)</a>》后,<a target="_blank" rel="noopener" href="http://morlay.tla42.org/">墨磊</a>[<a target="_blank" rel="noopener" href="https://github.com/morlay">GitHub</a>]给出的解决方案，基本上就是使用自定义任务把构建任务分解在不同的文件中的。</p>
<p>比如，在<a target="_blank" rel="noopener" href="https://github.com/gruntjs/gruntjs.com">gruntjs.com(https://github.com/gruntjs/gruntjs.com)</a>项目中，也是通过把blog、docs等任务从Gruntfile中分拆出来的。</p>
<p>代码示例如下：</p>
<pre><code>// Load local tasks
grunt.loadTasks(&#39;tasks&#39;); // getWiki, docs tasks

grunt.registerTask(&#39;build&#39;, [&#39;clean&#39;, &#39;copy&#39;, &#39;jade&#39;, &#39;docs&#39;, &#39;blog&#39;, &#39;plugins&#39;, &#39;concat&#39;]);
</code></pre>
<p>上例中的docs、blog任务就是放在tasks目录下，使用grunt.loadTasks方法统一加载的。</p>
<h2 id="选择grunt-run-grunt插件"><a href="#选择grunt-run-grunt插件" class="headerlink" title="选择grunt-run-grunt插件"></a>选择grunt-run-grunt插件</h2><p>前文的所述的几个方案，用于分拆Gruntfile虽然很不错，但是并不能解决最初提出的后两个需求：</p>
<ul>
<li>分拆后的Gruntfile，能够不依赖于其他部分的独立构建。</li>
<li>package.json和node_modules要能够共用。</li>
</ul>
<p>我发现<a target="_blank" rel="noopener" href="https://github.com/Bartvds/grunt-run-grunt">grunt-run-grunt(https://github.com/Bartvds/grunt-run-grunt)</a>插件可以同时满足这三个需求。</p>
<p>很遗憾的是，这个插件关注的人不多，Fork的人也不多。或许其他的开发团队有更高明的方案也说不一定，还需要继续跟进。</p>
<h2 id="项目的组织方案"><a href="#项目的组织方案" class="headerlink" title="项目的组织方案"></a>项目的组织方案</h2><p>在选型定案使用grunt-run-grunt插件以后，项目的组织就确定了。</p>
<p>入口Gruntfile的代码示例：</p>
<pre><code>run_grunt:&#123;
  options: &#123;
    &#39;base&#39;: require(&#39;path&#39;).resolve(&#39;.&#39;)
  &#125;,
  main:&#123;
    src: [&#39;src/pro/a.Gruntfile.js&#39;, &#39;src/frameworks/b.lib.Gruntfile.js&#39;, &#39;src/frameworks/c.lib.Gruntfile.js&#39;]        
  &#125;
&#125;
</code></pre>
<p>需要特别注意的是，options中的base配置是指整个项目所有的Gruntfile都是以这个入口Gruntfile所在的目录为base目录的。</p>
<p>这个扩展机制可以在options中配置最终传递给grunt的命令行参数，属性名是命令行参数名，属性值是命令行参数的值。</p>
<p>上例配置的意义是要求执行类似如下样式的Grunt命令：</p>
<pre><code>grunt --base e:/dev/
</code></pre>
<p>各部分的Gruntfile与正常的Gruntfile没有什么区别。唯一的区别就是，这个方案把所有的Gruntfile的base目录设定为入口Gruntfile所在的目录。</p>
<p>比如，src&#x2F;pro&#x2F;a.Gruntfile.js中的代码示例如下：</p>
<pre><code>concat: &#123;
  &quot;pro: &#123;
    src: [
      &quot;src/frameworks/b.lib.js&quot;,
      &quot;src/frameworks/c.lib.js&quot;,
      &quot;src/pro/a.js&quot;
    ],
    dest: &quot;dist/pro/a.js&quot;
  &#125;
&#125;
</code></pre>
<p>示例中，不管是src目录，还是dest目录，都是以入口Gruntfile目录为基准的。</p>
<p>当然，base目录不这样安排是最简单的，在入口Gruntfile的run_grunt任务中不配置base就可以了。如此以来，所有的Gruntfile中的目录都是以本Gruntfile所在目录为base目录的。</p>

      
    </div>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/articles/it-lessons-2013-10-15-installation-and-use-of-grunt.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Grunt的安装和使用
        
      </div>
    </a>
  
  
    <a href="/articles/it-lessons-2013-10-12-unit-test-by-qunit.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">在javascript项目中使用QUint进行单元测试</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">
      <img src="/images/weixin.png" alt="weixin" width="100%" />
    </h3>
    <div class="widget">
      <ul class="self-media-list">
        
          <li>
            <a target="_blank" rel="noopener" href="https://weread.qq.com/">微信读书</a>
          </li>
        
          <li>
            <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/cgi-bin/home">微信公众号</a>
          </li>
        
          <li>
            <a target="_blank" rel="noopener" href="https://channels.weixin.qq.com/platform">视频号助手</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/essay/">札记随笔</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/essay/arts/">文艺随笔</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/travel/">老周游记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/read/">读书笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/essay/thinking/">思考札记</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/classic/">典籍学习</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/classic/qing-shi/">清史稿</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/classic/sutra/">佛经</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/classic/analects/">论语</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/classic/su-wen/">黄帝内经素问</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/poem/">培公诗抄</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/poem/a-2015/">2015 ~ 2024</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/poem/a-2010/">2010 ~ 2014</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/poem/a-2004/">2004 ~ 2009</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/poem/b-2004/">~ 2004 年</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/poem/buddha/">禅宗心得</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/poem/characters/">人物</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/catalog/">藏书目录</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/catalog/bookcase/">在架图书</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/catalog/table/">封存图书</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">IT</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/env/">开发环境</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/manual/">常用文档</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/studio/">学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/lessons/">培训教程</a></li></ul></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 VET. 周培公<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/proposals" class="mobile-nav-link">写作计划</a>
  
    <a href="/books" class="mobile-nav-link">藏书目录</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>