<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>在javascript项目中使用QUint进行单元测试-LocalAd周培公</title>
    <meta name="description" content="化尽情缘修古寺，扫遍佛塔入天山。
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://www.peigong.net/articles/lessons/unit-test-by-qunit.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">LocalAd周培公</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">在javascript项目中使用QUint进行单元测试</h1>
    <p class="post-meta">Oct 12, 2013</p>
  </header>

  <article class="post-content">
    
<h2 id="qunit">QUnit的简介</h2>

<blockquote>
  <p>本文只介绍<a href="http://qunitjs.com/">Qunit</a>的使用，不再介绍单元测试框架的选型过程。</p>
</blockquote>

<p>QUnit的官网介绍：</p>

<p>QUnit is a powerful, easy-to-use JavaScript unit testing framework. </p>

<p>QUnit是一个强大的、简单易用的javascript单元测试框架。</p>

<h3 id="qunit-1">下载QUnit</h3>

<p>可以到<a href="http://qunitjs.com/">QUnit官网(http://qunitjs.com)</a>上下载qunit.js和qunit.css两个文件。</p>

<p>虽然有<a href="http://code.jquery.com/">jQuery CDN(http://code.jquery.com/)</a>和<a href="https://github.com/jquery/qunit">GitHub托管(https://github.com/jquery/qunit)</a>的代码可用，但是为了稳定，还是下载了使用吧。</p>

<h3 id="qunit-2">QUnit上手应用</h3>

<blockquote>
  <p>以下的代码示例直接使用QUnit官网首页的示例。</p>
</blockquote>

<p>QUnit单元测试的HTML页面代码示例：</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;QUnit Example&lt;/title&gt;
  &lt;link rel="stylesheet" href="/resources/qunit.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="qunit"&gt;&lt;/div&gt;
  &lt;div id="qunit-fixture"&gt;&lt;/div&gt;
  &lt;script src="/resources/qunit.js"&gt;&lt;/script&gt;
  &lt;script src="/resources/tests.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>tests.js中的示例代码：</p>

<pre><code>test( "hello test", function() {
  ok( 1 == "1", "Passed!" );
});
</code></pre>

<h2 id="qunitapi">QUnit的常用API</h2>

<blockquote>
  <p>断言是单元测试中最常用、最核心的概念，就是在测试的时候，对代码的运行结果作出的一些假设。如果断言成立，就说单元测试通过，反之则视为测试失败。</p>
</blockquote>

<h3 id="section">测试方法和模块</h3>

<p>最常用的测试代码，示例如下：</p>

<pre><code>test("该测试用例的主题", function(){/*- 具体的测试断言 -*/});
</code></pre>

<p>当测试用例较多时，可以用module()方法进行分组。示例如下：</p>

<pre><code>module( "测试分组一" );
test( "测试方法1", function() {});
test( "测试方法2", function() {});
 
module( "测试分组二" );
test( "测试方法3", function() {});
test( "测试方法4", function() {});
</code></pre>

<p>在测试结果HTML页面上，会以 <code>测试分组一：测试方法1</code> 的形式呈现。</p>

<h3 id="section-1">异步测试</h3>

<p>javascript编程中，经常用到回调函数，所以异步测试也是经常用到的。</p>

<p>如下示例：</p>

<pre><code>asyncTest( "asynchronous test: one second later!", function() {
  expect( 1 );
 
  setTimeout(function() {
    ok( true, "Passed and ready to resume!" );
    start();
  }, 1000);
});
</code></pre>

<p><strong>注意</strong><code>start()</code>函数的用法。</p>

<p>由于是异步调用，所以使用<code>expect()</code>告诉QUnit期待几个断言是个好习惯。</p>

<h3 id="qunit-3">QUnit支持的断言</h3>

<blockquote>
  <p>一个测试方法只有一个断言是个好习惯。只是好习惯哦！</p>
</blockquote>

<p>一目了然，<strong>ok和equal是最常用的</strong>。</p>

<ul>
  <li>ok( state, message ) ： 真假断言，state为true则通过。</li>
  <li>equal( actual, expected, message ) ： 相等断言，actual和expected相等（==）则通过。</li>
  <li>notEqual( actual, expected, message ) ： 不等断言，actual和expected不相等（!=）则通过。</li>
  <li>deepEqual( actual, expected, message ) ： 递归相等断言，actual和expected全相等（包括其子元素都相等，适用于基本类型，数组和对象）则通过。</li>
  <li>notDeepEqual( actual, expected, message ) ： 递归不相等断言，actual和expected不全相等（包括其子元素都相等，适用于基本类型，数组和对象）则通过。</li>
  <li>strictEqual( actual, expected, message ) ： 全相等断言，actual和expected全相等（===）则通过。</li>
  <li>notStrictEqual( actual, expected, message ) ： 不全相等断言，actual和expected不全相等（===）则通过。</li>
  <li>raises( block, expected, message ) ： 异常断言，block中抛出异常则通过，expected为可选参数，是所期待抛出异常名的正则表达式。</li>
</ul>

<h2 id="grunt">与Grunt构建工具的集成</h2>

<p>Grunt构建工具的安装和使用，可以参考教程<a href="http://clientlab.github.io/lessons/2013/10/15/installation-and-use-of-grunt/">《Grunt的安装和使用》</a></p>

<h3 id="qunitgrunt">QUnit的Grunt任务</h3>

<p>QUnit Grunt任务(grunt-contrib-qunit)的使用，请参见GitHub上的说明<a href="https://github.com/gruntjs/grunt-contrib-qunit">https://github.com/gruntjs/grunt-contrib-qunit</a>。</p>

<p>使用QUint作单元测试，PhantomJS是必须要安装的。<a href="http://phantomjs.org/">PhantomJS(http://phantomjs.org/)</a> 是一个无界面的WebKit浏览器引擎，还有配套的JavaScript API。它原生支持各种web标准技术：DOM处理，CSS选择器，JSON，Canvas，以及SVG。</p>

<p>安装grunt-contrib-qunit任务时，作为npm依赖项，PhantomJS会自己被安装。</p>

<p>也可以在命令行中使用以下的命令进行安装：</p>

<pre><code>npm install phantomjs -g
</code></pre>

<p><strong>友情提示：</strong></p>

<p>本来这一切都是顺理成章，非常流畅的。可惜，一道国墙给这个世界的互联互通制造了些许障碍。</p>

<p>如果电脑上从来没有安装过PhantomJS，或者当前的版本不够高，安装程序会自动从bitbucket网站上下载，例如：http://cdn.bitbucket.org/ariya/phantomjs/downloads/phantomjs-1.9.7-windows.zip。但是，非常不幸，这个地址是被墙了的。</p>

<p>你可以从各种不同的途径，获取这个压缩包（比如给我发邮件：peigong@foxmail.com），然后拷贝到C:\Users\Administrator\AppData\Local\Temp\phantomjs（具体地址根据自己的电脑作调整，或者查看安装报错的信息）。接着，重新启动安装，一切都OK了！</p>

<h2 id="section-2">参考资料</h2>

<ul>
  <li><a href="http://www.cnblogs.com/nuaalfm/archive/2010/02/26/1674235.html">JQuery团队打造的javascript单元测试工具QUnit介绍</a></li>
  <li><a href="http://www.tuicool.com/articles/JVRRbq">DalekJS – 基于 JavaScript 实现跨浏览器的自动化测试</a></li>
  <li><a href="http://www.ibm.com/developerworks/cn/opensource/os-jstesting/">高效 JavaScript 单元测试</a></li>
  <li><a href="http://select.yeeyan.org/view/213582/265887">JavaScript的单元测试工具</a></li>
  <li><a href="http://www.infoq.com/cn/articles/javascript-unit-testing">虚拟座谈：JavaScript单元测试现状</a></li>
  <li><a href="http://www.cnblogs.com/frostbelt/archive/2012/08/03/2622302.html">javascript单元测试</a></li>
  <li><a href="http://nodejs.org">Node.js 官网(http://nodejs.org)</a></li>
  <li><a href="http://qunitjs.com/">QUnit 官网</a> - <a href="https://github.com/jquery/qunit">GitHub</a></li>
  <li><a href="http://www.gruntjs.com">Grunt 官网</a> - [<a href="https://github.com/gruntjs/">GitHub</a>] [<a href="http://www.gruntjs.org/">中文文档</a>]</li>
  <li><a href="http://phantomjs.org">PhantomJS官网(http://phantomjs.org)</a></li>
  <li><a href="https://npmjs.org/package/phantomjs">https://npmjs.org/package/phantomjs</a></li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">LocalAd周培公</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>LocalAd周培公</li>
          <li><a href="mailto:peigong@foxmail.com">peigong@foxmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">化尽情缘修古寺，扫遍佛塔入天山。
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
