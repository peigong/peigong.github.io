<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>CentOS下安装git和配置git服务器-LocalAd周培公</title>
    <meta name="description" content="化尽情缘修古寺，扫遍佛塔入天山。
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://www.peigong.net/articles/lessons/CentOS-git-setup.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">LocalAd周培公</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">CentOS下安装git和配置git服务器</h1>
    <p class="post-meta">Jun 9, 2014</p>
  </header>

  <article class="post-content">
    
<p>在远程仓库一节中，我们讲了远程仓库实际上和本地仓库没啥不同，纯粹为了7x24小时开机并交换大家的修改。</p>

<p>GitHub就是一个免费托管开源代码的远程仓库。但是对于某些视源代码如生命的商业公司来说，既不想公开源代码，又舍不得给GitHub交保护费，那就只能自己搭建一台Git服务器作为私有仓库使用。</p>

<p>搭建Git服务器需要准备一台运行Linux的机器，强烈推荐用Ubuntu或CentOS，这样，通过几条简单的apt或yum命令就可以完成安装。</p>

<p>假设你已经有sudo权限的用户账号，下面，正式开始安装。</p>

<h3 id="git">第一步，安装git：</h3>

<pre><code>yum install curl curl-devel zlib-devel openssl-devel perl cpio expat-devel gettext-devel
</code></pre>

<p>下载最新的git包</p>

<pre><code>wget http://www.codemonkey.org.uk/projects/git-snapshots/git/git-latest.tar.gz
tar xzvf git-latest.tar.gz
cd git-2011-11-30 ＃你的目录可能不是这个
autoconf
./configure --prefix=/usr/local/git
make
make install
</code></pre>

<p>检查下安装的版本，大功告成</p>

<pre><code>git --version
</code></pre>

<h3 id="gitgit">第二步，创建一个git用户，用来运行git服务：</h3>

<pre><code>$ sudo adduser git
$ git config --global user.name "whdsmile"
$ git config --global user.email "whdsmile@gmail.com"
</code></pre>

<h3 id="section">第三步，创建证书登录：</h3>

<p>收集所有需要登录的用户的公钥，就是他们自己的id_rsa.pub文件，把所有公钥导入到/home/git/.ssh/authorized_keys文件里，一行一个。</p>

<h3 id="git-1">第四步，初始化Git仓库：</h3>

<p>先选定一个目录作为Git仓库，假定是/srv/sample.git，在/srv目录下输入命令：</p>

<pre><code>$ sudo git init --bare sample.git
</code></pre>

<p>Git就会创建一个裸仓库，裸仓库没有工作区，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，并且服务器上的Git仓库通常都以.git结尾。然后，把owner改为git：</p>

<p>$ sudo chown -R git:git sample.git</p>

<h3 id="shell">第五步，禁用shell登录：</h3>

<p>出于安全考虑，第二步创建的git用户不允许登录shell，这可以通过编辑/etc/passwd文件完成。找到类似下面的一行：</p>

<pre><code>git:x:1001:1001:,,,:/home/git:/bin/bash
改为：
git:x:1001:1001:,,,:/home/git:/usr/local/git/bin/git-shell 这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git-shell每次一登录就自动退出。
</code></pre>

<h3 id="srvsamplegittest">第六步，在/srv/sample.git目录下，假设有一个test目录：</h3>

<pre><code>$ git add test
$ git commit -m "add file"
</code></pre>

<h3 id="section-1">第七步，在开发机上克隆远程仓库：</h3>

<p>现在，可以通过git clone命令克隆远程仓库了，在各自的电脑上运行：</p>

<pre><code>$ git clone git@server:/srv/sample.git

Cloning into 'sample'...
warning: You appear to have cloned an empty repository. 剩下的推送就简单了。
</code></pre>

<p>管理公钥
如果团队很小，把每个人的公钥收集起来放到服务器的/home/git/.ssh/authorized_keys文件里就是可行的。如果团队有几百号人，就没法这么玩了，这时，可以用Gitosis来管理公钥。</p>

<p>这里我们不介绍怎么玩Gitosis了，几百号人的团队基本都在500强了，相信找个高水平的Linux管理员问题不大。</p>

<h3 id="section-2">参考资料</h3>

<ul>
  <li><a href="http://clientlab.github.io/lessons/2014/02/22/TortoiseGit-andl-msysGit-for-gitlab/">GitLab和TortoiseGit、msysGit的配合使用</a></li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">LocalAd周培公</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>LocalAd周培公</li>
          <li><a href="mailto:peigong@foxmail.com">peigong@foxmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">化尽情缘修古寺，扫遍佛塔入天山。
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
